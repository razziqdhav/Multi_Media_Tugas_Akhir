<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ROOM 304 — Interactive Short Film</title>

  <style>
    * { box-sizing: border-box; }

    :root{
      --bg: #070a10;
      --card: rgba(10, 14, 22, .72);
      --border: rgba(255,255,255,.12);
      --text: #e8eefc;
      --muted: rgba(232,238,252,.72);
      --accent: rgba(255, 66, 66, .90);
      --accent2: rgba(255, 204, 120, .65);
    }

    body{
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: var(--bg);
      min-height: 100vh;

      /* GANTI ini dengan background pintu kamu */
      background-image:
        radial-gradient(1200px 700px at 50% 20%, rgba(255,255,255,.08), transparent 60%),
        linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,.92)),
        url("assets/bg-door.jpg");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }

    /* vignette + kabut */
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(80% 60% at 50% 35%, rgba(0,0,0,.20), rgba(0,0,0,.85) 70%),
        radial-gradient(40% 30% at 20% 70%, rgba(255,255,255,.05), transparent 60%),
        radial-gradient(30% 25% at 75% 55%, rgba(255,255,255,.04), transparent 60%);
      opacity: 1;
    }

    /* grain/noise */
    body::after{
      content:"";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image:
        repeating-linear-gradient(0deg, rgba(255,255,255,.03), rgba(255,255,255,.03) 1px, transparent 1px, transparent 3px),
        repeating-linear-gradient(90deg, rgba(255,255,255,.02), rgba(255,255,255,.02) 1px, transparent 1px, transparent 4px);
      opacity: .10;
      filter: contrast(120%);
      animation: grainMove 6s steps(10) infinite;
    }
    @keyframes grainMove{
      0%{ transform: translate(0,0); }
      20%{ transform: translate(-10px, 6px); }
      40%{ transform: translate(8px, -8px); }
      60%{ transform: translate(-6px, -10px); }
      80%{ transform: translate(10px, 10px); }
      100%{ transform: translate(0,0); }
    }

    .wrap{
      width: min(1100px, 92vw);
      margin: 0 auto;
      padding: 26px 16px 20px;
      position: relative;
      z-index: 1;
    }

    .top{ text-align: center; margin-bottom: 16px; }
    .title{
      margin: 0;
      font-size: clamp(34px, 4.2vw, 64px);
      letter-spacing: 6px;
      text-transform: uppercase;
      font-weight: 800;
      text-shadow:
        0 0 14px rgba(0,0,0,.8),
        0 0 22px rgba(0,0,0,.7),
        0 0 10px rgba(255, 200, 120, .25),
        0 0 12px rgba(255, 66, 66, .18);
      animation: titleFlicker 4.5s infinite;
    }
    @keyframes titleFlicker{
      0%, 100% { opacity: 1; filter: brightness(1); }
      2% { opacity: .88; filter: brightness(1.05); }
      3% { opacity: 1; }
      48% { opacity: .75; }
      49% { opacity: 1; }
    }
    .tagline{
      margin: 10px 0 0;
      color: var(--muted);
      letter-spacing: 1.2px;
      font-size: 14px;
    }

    /* ====== STAGE (yang akan di-fullscreen-kan) ====== */
    #stage{
      position: relative;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 20px 70px rgba(0,0,0,.65);
      overflow: hidden;
      backdrop-filter: blur(10px);
    }
    #stage::before{
      content:"";
      position:absolute;
      inset: 0;
      pointer-events:none;
      border-radius: 18px;
      background:
        linear-gradient(135deg, rgba(255,66,66,.20), transparent 40%),
        linear-gradient(315deg, rgba(255,204,120,.10), transparent 45%);
      opacity: .6;
    }

    video{
      width: 100%;
      height: 72vh;
      max-height: 72vh;
      border-radius: 14px;
      background: #000;
      display:block;
      object-fit: contain;
      box-shadow: 0 18px 40px rgba(0,0,0,.6);
      position: relative;
      z-index: 1;
    }

    .meta{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
      position: relative;
      z-index: 1;
    }

    .chips{ display:flex; gap: 8px; flex-wrap: wrap; align-items:center; }
    .chip{
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      font-size: 12px;
      color: rgba(232,238,252,.85);
    }

    button{
      border: 0;
      border-radius: 12px;
      padding: 10px 14px;
      cursor: pointer;
      font-weight: 800;
    }
    button.primary{
      background: var(--accent);
      color: #120408;
      box-shadow: 0 10px 22px rgba(255,66,66,.18);
    }
    button.secondary{
      background: rgba(255,255,255,.10);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.14);
    }
    button.ghost{
      background: transparent;
      color: rgba(232,238,252,.92);
      border: 1px solid rgba(255,255,255,.18);
    }

    /* ===== POPUP OVERLAY (akan tetap tampil saat stage fullscreen) ===== */
    .overlay{
      position:absolute;
      inset: 0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      background: rgba(0,0,0,.74);
      backdrop-filter: blur(4px);
      z-index: 10;
    }
    .overlay.show{ display:flex; }

    .modal{
      width: min(560px, 100%);
      border-radius: 18px;
      background: rgba(8,10,15,.88);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 26px 90px rgba(0,0,0,.75);
      padding: 18px;
      position: relative;
      overflow:hidden;
      animation: pop .14s ease-out;
    }
    .modal::before{
      content:"";
      position:absolute;
      left: -30%;
      top: -40%;
      width: 120%;
      height: 120%;
      background: radial-gradient(circle at 70% 60%, rgba(255,204,120,.12), transparent 55%);
      transform: rotate(12deg);
      opacity: .8;
      pointer-events:none;
    }
    @keyframes pop{
      from{ transform: scale(.98); opacity: 0; }
      to{ transform: scale(1); opacity: 1; }
    }
    .modal h2{
      margin: 0 0 6px;
      font-size: 18px;
      letter-spacing: 1px;
      position: relative;
      z-index: 1;
    }
    .modal p{
      margin: 0 0 12px;
      opacity: .88;
      line-height: 1.45;
      position: relative;
      z-index: 1;
    }
    .modal .btns{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      position: relative;
      z-index: 1;
    }

    .foot{
      text-align:center;
      margin-top: 12px;
      opacity: .7;
      position: relative;
      z-index: 1;
    }

    /* ====== Saat stage fullscreen ====== */
    #stage:fullscreen{
      width: 100vw;
      height: 100vh;
      border-radius: 0;
      padding: 12px;
      background: rgba(0,0,0,.88);
      border: none;
    }
    #stage:fullscreen::before{ display:none; }

    /* video dibuat memenuhi layar ketika fullscreen */
    #stage:fullscreen video{
      height: calc(100vh - 78px); /* sisakan ruang untuk meta */
      max-height: calc(100vh - 78px);
      border-radius: 12px;
    }

    /* meta diposisikan di bawah saat fullscreen biar rapi */
    #stage:fullscreen .meta{
      margin-top: 8px;
    }

    @media (max-width: 768px){
      .wrap{ width: 95vw; padding-top: 18px; }
      video{ height: 52vh; max-height: 52vh; }
      .title{ letter-spacing: 4px; }
    }
  </style>
</head>

<body>
  <main class="wrap">
    <header class="top">
      <h1 class="title">ROOM 304</h1>
      <p class="tagline">interactive short film • pilih alur ceritanya</p>
    </header>

    <!-- STAGE: yang kita fullscreen-kan -->
    <section id="stage">
      <video id="player" controls playsinline preload="metadata" crossorigin="anonymous">
        Browser kamu tidak mendukung video.
      </video>

      <!-- POPUP -->
      <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal">
          <h2 id="modalTitle">Pilih keputusan</h2>
          <p id="modalPrompt">...</p>
          <div id="modalButtons" class="btns"></div>
        </div>
      </div>

      <div class="meta">
        <div class="chips">
          <span class="chip" id="sceneLabel">Scene: -</span>
          <span class="chip" id="pathLabel">Jejak: -</span>
        </div>

        <div class="btns">
          <button id="fsBtn" class="primary">Fullscreen</button>
          <button id="restartBtn" class="ghost">Ulang</button>
          <button id="clearPathBtn" class="ghost">Reset</button>
        </div>
      </div>
    </section>

    <footer class="foot">
      <small>© Kelompok kamu — Tugas Akhir Multimedia</small>
    </footer>
  </main>

  <script>
    const stage = document.getElementById("stage");
    const player = document.getElementById("player");
    const overlay = document.getElementById("overlay");
    const modalPrompt = document.getElementById("modalPrompt");
    const modalButtons = document.getElementById("modalButtons");
    const sceneLabel = document.getElementById("sceneLabel");
    const pathLabel = document.getElementById("pathLabel");
    const restartBtn = document.getElementById("restartBtn");
    const clearPathBtn = document.getElementById("clearPathBtn");
    const fsBtn = document.getElementById("fsBtn");

    const PATH_KEY = "room304_branch_path";
    function getPath() {
      try { return JSON.parse(localStorage.getItem(PATH_KEY) || "[]"); }
      catch { return []; }
    }
    function setPath(arr) {
      localStorage.setItem(PATH_KEY, JSON.stringify(arr));
      pathLabel.textContent = "Jejak: " + (arr.length ? arr.join(" → ") : "-");
    }

    // ====== DEMO SCENE (ganti src ke video kalian nanti) ======
    const SCENES = {
      intro: {
        label: "Intro",
        src: "https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4",
        choiceAt: 5,
        prompt: "Kamu dengar suara dari balik pintu. Kamu mau…",
        choices: [
          { text: "Buka pintunya perlahan", to: "a1", tag: "Buka" },
          { text: "Pergi cari bantuan", to: "b1", tag: "Pergi" },
        ],
      },
      a1: {
        label: "Koridor Gelap",
        src: "https://interactive-examples.mdn.mozilla.net/media/cc0-videos/friday.mp4",
        choiceAt: 6,
        prompt: "Di dalam gelap. Ada sesuatu bergerak. Kamu…",
        choices: [
          { text: "Nyalakan flash HP", to: "end1", tag: "Flash" },
          { text: "Lari", to: "end2", tag: "Lari" },
        ],
      },
      b1: {
        label: "Tangga",
        src: "http://media.w3.org/2010/05/sintel/trailer.mp4",
        choiceAt: 7,
        prompt: "Langkahmu terdengar berat. Di belakangmu ada bayangan. Kamu…",
        choices: [
          { text: "Balik badan", to: "end1", tag: "Balik" },
          { text: "Tetap jalan", to: "end2", tag: "Jalan" },
        ],
      },
      end1: { label: "Ending 1", src: "https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4", choiceAt: null, prompt: null, choices: [] },
      end2: { label: "Ending 2", src: "https://interactive-examples.mdn.mozilla.net/media/cc0-videos/friday.mp4", choiceAt: null, prompt: null, choices: [] },
    };

    let currentSceneKey = "intro";
    let choiceShown = false;

    function showOverlay(scene) {
      modalPrompt.textContent = scene.prompt || "Pilih:";
      modalButtons.innerHTML = "";

      scene.choices.forEach((c, idx) => {
        const btn = document.createElement("button");
        btn.textContent = c.text;
        btn.className = idx === 0 ? "primary" : "secondary";
        btn.addEventListener("click", () => {
          const p = getPath();
          p.push(c.tag);
          setPath(p);
          hideOverlay();
          loadScene(c.to);
        });
        modalButtons.appendChild(btn);
      });

      overlay.classList.add("show");
    }

    function hideOverlay() {
      overlay.classList.remove("show");
    }

    function loadScene(key) {
      const scene = SCENES[key];
      if (!scene) return;

      currentSceneKey = key;
      choiceShown = false;

      hideOverlay();
      sceneLabel.textContent = "Scene: " + scene.label;
      setPath(getPath());

      player.pause();
      player.src = scene.src;
      player.load();
      player.currentTime = 0;

      player.play().catch(() => {});
    }

    player.addEventListener("timeupdate", () => {
      const scene = SCENES[currentSceneKey];
      if (!scene || scene.choiceAt == null) return;

      if (!choiceShown && player.currentTime >= scene.choiceAt) {
        choiceShown = true;
        player.pause();
        showOverlay(scene);
      }
    });

    restartBtn.addEventListener("click", () => loadScene("intro"));
    clearPathBtn.addEventListener("click", () => {
      setPath([]);
      loadScene("intro");
    });

    // ====== FULLSCREEN: fullscreen-kan STAGE (bukan video), supaya popup ikut tampil ======
    function isFs() {
      return document.fullscreenElement === stage;
    }

    async function toggleFullscreen() {
      try {
        if (!isFs()) {
          await stage.requestFullscreen();
        } else {
          await document.exitFullscreen();
        }
      } catch (e) {
        alert("Fullscreen tidak didukung di browser ini.");
      }
    }

    fsBtn.addEventListener("click", toggleFullscreen);

    document.addEventListener("fullscreenchange", () => {
      fsBtn.textContent = isFs() ? "Exit Fullscreen" : "Fullscreen";
    });

    // start
    setPath(getPath());
    loadScene("intro");
  </script>
</body>
</html>
